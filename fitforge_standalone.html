<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>FitForge - 6-Week Progressive Training</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6c5ce7">
    <meta name="description" content="FitForge - Your personal 6-week progressive training program with workout tracking, rest timers, progress charts, and body measurement logging.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¥</text></svg>">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body, #root { width: 100%; min-height: 100vh; min-height: 100dvh; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif; overflow-x: hidden; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        textarea { font-family: inherit; }
        ::-webkit-scrollbar { height: 4px; width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        @keyframes slideDown { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #loading-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; flex-direction: column; background: #f8f7ff; z-index: 9999; }
        #loading-screen .spinner { width: 40px; height: 40px; border: 4px solid #e8e5f5; border-top-color: #6c5ce7; border-radius: 50%; animation: spin 0.8s linear infinite; margin-top: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root">
        <div id="loading-screen">
            <div style="font-size: 56px;">ðŸ”¥</div>
            <h1 style="font-size: 28px; font-weight: 800; color: #1a1632; letter-spacing: -1px; margin-top: 12px;">FitForge</h1>
            <div class="spinner"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>

    <script type="text/babel" data-type="module">
    const { useState, useEffect, useRef, useCallback } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip: RTooltip, ResponsiveContainer, BarChart, Bar, Legend } = Recharts;

    // Alias Tooltip to avoid JSX conflicts
    const ChartTooltip = RTooltip;

    // ============================================================
    // ============================================================
    const Icon = ({ name, size = 20, color = "currentColor", style: iconStyle = {} }) => {
        const paths = {
            play: () => <polygon points="5,3 19,12 5,21" fill={color}/>,
            pause: () => <><rect x="6" y="4" width="4" height="16" fill={color}/><rect x="14" y="4" width="4" height="16" fill={color}/></>,
            rotateCcw: () => <><polyline points="1,4 1,10 7,10" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            moon: () => <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            sun: () => <><circle cx="12" cy="12" r="5" fill="none" stroke={color} strokeWidth="2"/><line x1="12" y1="1" x2="12" y2="3" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="12" y1="21" x2="12" y2="23" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="1" y1="12" x2="3" y2="12" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="21" y1="12" x2="23" y2="12" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke={color} strokeWidth="2" strokeLinecap="round"/></>,
            chevronRight: () => <polyline points="9,18 15,12 9,6" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            chevronLeft: () => <polyline points="15,18 9,12 15,6" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            dumbbell: () => <><path d="m6.5 6.5 11 0m-11 11 11 0" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round"/><rect x="3" y="6" width="4" height="12" rx="1" fill="none" stroke={color} strokeWidth="2"/><rect x="17" y="6" width="4" height="12" rx="1" fill="none" stroke={color} strokeWidth="2"/><line x1="3" y1="12" x2="1" y2="12" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="23" y1="12" x2="21" y2="12" stroke={color} strokeWidth="2" strokeLinecap="round"/></>,
            barChart: () => <><line x1="12" y1="20" x2="12" y2="10" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="18" y1="20" x2="18" y2="4" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="6" y1="20" x2="6" y2="16" stroke={color} strokeWidth="2" strokeLinecap="round"/></>,
            clock: () => <><circle cx="12" cy="12" r="10" fill="none" stroke={color} strokeWidth="2"/><polyline points="12,6 12,12 16,14" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            user: () => <><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><circle cx="12" cy="7" r="4" fill="none" stroke={color} strokeWidth="2"/></>,
            home: () => <><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><polyline points="9,22 9,12 15,12 15,22" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            book: () => <><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            target: () => <><circle cx="12" cy="12" r="10" fill="none" stroke={color} strokeWidth="2"/><circle cx="12" cy="12" r="6" fill="none" stroke={color} strokeWidth="2"/><circle cx="12" cy="12" r="2" fill="none" stroke={color} strokeWidth="2"/></>,
            plus: () => <><line x1="12" y1="5" x2="12" y2="19" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="5" y1="12" x2="19" y2="12" stroke={color} strokeWidth="2" strokeLinecap="round"/></>,
            x: () => <><line x1="18" y1="6" x2="6" y2="18" stroke={color} strokeWidth="2" strokeLinecap="round"/><line x1="6" y1="6" x2="18" y2="18" stroke={color} strokeWidth="2" strokeLinecap="round"/></>,
            check: () => <polyline points="20,6 9,17 4,12" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            trash: () => <><polyline points="3,6 5,6 21,6" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            trophy: () => <><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M4 22h16" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            flame: () => <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            trendingUp: () => <><polyline points="23,6 13.5,15.5 8.5,10.5 1,18" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><polyline points="17,6 23,6 23,12" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
            heart: () => <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>,
            weight: () => <><circle cx="12" cy="5" r="3" fill="none" stroke={color} strokeWidth="2"/><path d="M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.23A2 2 0 0 0 4 21h16a2 2 0 0 0 1.9-2.77l-2.49-8.77A2 2 0 0 0 17.5 8" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></>,
        };
        const render = paths[name];
        return <svg width={size} height={size} viewBox="0 0 24 24" style={iconStyle}>{render ? render() : null}</svg>;
    };





// ============================================================
// PROGRAM DATA - Full 6-week progressive training program
// ============================================================
const DEFAULT_PROGRAM = {
  meta: {
    name: "6-Week Progressive Training",
    level: "Intermediate",
    duration: "45-60 min",
    equipment: "Barbells, Dumbbells, Kettlebells, Medicine Balls",
    goals: "Strength, Muscle Building, Fat Loss, General Fitness",
    daysPerWeek: 6
  },
  weeks: {
    1: {
      name: "Foundation", focus: "Technique refinement, building base volume, moderate intensity",
      rpe: "7/10", intensity: "70-75%",
      days: {
        1: { name: "Upper Push", type: "push", exercises: [
          { name: "Barbell Bench Press", sets: 4, reps: "8", rest: "2.5-3 min" },
          { name: "Dumbbell Overhead Press", sets: 3, reps: "10", rest: "2 min" },
          { name: "Incline Dumbbell Press", sets: 3, reps: "12", rest: "90 sec" },
          { name: "Dumbbell Lateral Raises", sets: 3, reps: "15", rest: "60 sec" },
          { name: "Overhead Tricep Extension", sets: 3, reps: "12", rest: "60 sec" }
        ]},
        2: { name: "Lower Body", type: "lower", exercises: [
          { name: "Barbell Back Squat", sets: 4, reps: "8", rest: "3 min" },
          { name: "Romanian Deadlift", sets: 3, reps: "10", rest: "2 min" },
          { name: "Goblet Squat", sets: 3, reps: "15", rest: "90 sec" },
          { name: "Bulgarian Split Squats", sets: 3, reps: "10/leg", rest: "90 sec" },
          { name: "Kettlebell Swings", sets: 3, reps: "20", rest: "60 sec" }
        ]},
        3: { name: "Upper Pull", type: "pull", exercises: [
          { name: "Barbell Bent-Over Row", sets: 4, reps: "8", rest: "2.5 min" },
          { name: "Single-Arm Dumbbell Row", sets: 3, reps: "12/arm", rest: "90 sec" },
          { name: "Dumbbell Pullover", sets: 3, reps: "15", rest: "90 sec" },
          { name: "Dumbbell Bicep Curls", sets: 3, reps: "12", rest: "60 sec" },
          { name: "Rear Delt Flyes", sets: 3, reps: "15", rest: "60 sec" }
        ]},
        4: { name: "Full Body Circuit", type: "full", exercises: [
          { name: "Dumbbell Thrusters", sets: 3, reps: "12", rest: "Circuit" },
          { name: "Renegade Rows", sets: 3, reps: "10/arm", rest: "Circuit" },
          { name: "Goblet Reverse Lunges", sets: 3, reps: "10/leg", rest: "Circuit" },
          { name: "Medicine Ball Slams", sets: 3, reps: "15", rest: "Circuit" },
          { name: "Kettlebell Swings", sets: 3, reps: "20", rest: "2-3 min" }
        ]},
        5: { name: "Lower Power", type: "lower", exercises: [
          { name: "Box Jumps", sets: 4, reps: "6", rest: "2 min" },
          { name: "Barbell Front Squat", sets: 4, reps: "8", rest: "2.5 min" },
          { name: "Dumbbell Step-Ups", sets: 3, reps: "12/leg", rest: "90 sec" },
          { name: "Jump Squats", sets: 3, reps: "10", rest: "90 sec" },
          { name: "Walking Lunges", sets: 2, reps: "12/leg", rest: "60 sec" }
        ]},
        6: { name: "Active Recovery", type: "rest", isRestDay: true }
      }
    },
    2: {
      name: "Volume Build", focus: "Increased volume, progressive overload begins",
      rpe: "7.5-8/10", intensity: "75-80%",
      days: {
        1: { name: "Upper Push", type: "push", exercises: [
          { name: "Barbell Bench Press", sets: 5, reps: "6-8", rest: "3 min" },
          { name: "Dumbbell Overhead Press", sets: 4, reps: "8-10", rest: "2 min" },
          { name: "Incline Dumbbell Press", sets: 3, reps: "10-12", rest: "90 sec" },
          { name: "Cable Lateral Raises", sets: 3, reps: "12-15", rest: "60 sec" },
          { name: "Dips or Close-Grip Press", sets: 3, reps: "10-12", rest: "90 sec" },
          { name: "Tricep Rope Pushdowns", sets: 3, reps: "15", rest: "60 sec" }
        ]},
        2: { name: "Lower Body", type: "lower", exercises: [
          { name: "Barbell Back Squat", sets: 5, reps: "6-8", rest: "3 min" },
          { name: "Romanian Deadlift", sets: 4, reps: "8-10", rest: "2 min" },
          { name: "Goblet Squat", sets: 3, reps: "12-15", rest: "90 sec" },
          { name: "Bulgarian Split Squats", sets: 3, reps: "12/leg", rest: "90 sec" },
          { name: "Leg Curls", sets: 3, reps: "15", rest: "60 sec" },
          { name: "Kettlebell Swings", sets: 3, reps: "20", rest: "60 sec" }
        ]},
        3: { name: "Upper Pull", type: "pull", exercises: [
          { name: "Barbell Bent-Over Row", sets: 5, reps: "6-8", rest: "3 min" },
          { name: "Single-Arm Dumbbell Row", sets: 4, reps: "10-12/arm", rest: "90 sec" },
          { name: "Lat Pulldowns", sets: 3, reps: "10-12", rest: "90 sec" },
          { name: "Dumbbell Pullover", sets: 3, reps: "12-15", rest: "90 sec" },
          { name: "Barbell Bicep Curls", sets: 3, reps: "10-12", rest: "60 sec" },
          { name: "Face Pulls", sets: 3, reps: "15-20", rest: "60 sec" }
        ]},
        4: { name: "Full Body Strength", type: "full", exercises: [
          { name: "Power Cleans", sets: 4, reps: "5", rest: "2 min" },
          { name: "Front Squats", sets: 3, reps: "8", rest: "2.5 min" },
          { name: "Push Press", sets: 3, reps: "8", rest: "2 min" },
          { name: "Dumbbell RDL", sets: 3, reps: "10", rest: "90 sec" },
          { name: "Plank to Push-Up", sets: 3, reps: "10", rest: "60 sec" }
        ]},
        5: { name: "Lower Hypertrophy", type: "lower", exercises: [
          { name: "Barbell Deadlift", sets: 4, reps: "6", rest: "3 min" },
          { name: "Barbell Lunges", sets: 3, reps: "10/leg", rest: "2 min" },
          { name: "Leg Press", sets: 3, reps: "15", rest: "90 sec" },
          { name: "Single-Leg RDL", sets: 3, reps: "12/leg", rest: "90 sec" },
          { name: "Calf Raises", sets: 4, reps: "20", rest: "60 sec" }
        ]},
        6: { name: "Active Recovery", type: "rest", isRestDay: true }
      }
    },
    3: {
      name: "Peak Intensity", focus: "Maximum intensity, heavy loads, lower reps",
      rpe: "8.5-9/10", intensity: "80-85%",
      days: {
        1: { name: "Upper Push Heavy", type: "push", exercises: [
          { name: "Barbell Bench Press", sets: 5, reps: "5", rest: "3-4 min" },
          { name: "Dumbbell Overhead Press", sets: 4, reps: "6", rest: "2.5 min" },
          { name: "Weighted Dips", sets: 4, reps: "8", rest: "2 min" },
          { name: "Incline Barbell Press", sets: 3, reps: "8", rest: "2 min" },
          { name: "Dumbbell Lateral Raises", sets: 4, reps: "12", rest: "60 sec" }
        ]},
        2: { name: "Lower Heavy", type: "lower", exercises: [
          { name: "Barbell Back Squat", sets: 5, reps: "5", rest: "3-4 min" },
          { name: "Barbell Deadlift", sets: 4, reps: "5", rest: "3 min" },
          { name: "Front Squat", sets: 3, reps: "8", rest: "2.5 min" },
          { name: "Bulgarian Split Squats", sets: 3, reps: "10/leg", rest: "2 min" },
          { name: "Glute Ham Raises", sets: 3, reps: "8", rest: "90 sec" }
        ]},
        3: { name: "Upper Pull Heavy", type: "pull", exercises: [
          { name: "Barbell Bent-Over Row", sets: 5, reps: "5", rest: "3-4 min" },
          { name: "Weighted Pull-Ups", sets: 4, reps: "6", rest: "2.5 min" },
          { name: "T-Bar Rows", sets: 4, reps: "8", rest: "2 min" },
          { name: "Barbell Shrugs", sets: 3, reps: "12", rest: "90 sec" },
          { name: "Barbell Curls", sets: 4, reps: "8", rest: "90 sec" }
        ]},
        4: { name: "Full Body Power", type: "full", exercises: [
          { name: "Power Cleans", sets: 5, reps: "3", rest: "2.5 min" },
          { name: "Front Squats", sets: 4, reps: "6", rest: "2.5 min" },
          { name: "Push Press", sets: 4, reps: "6", rest: "2 min" },
          { name: "Box Jumps", sets: 4, reps: "5", rest: "2 min" },
          { name: "Medicine Ball Slams", sets: 3, reps: "10", rest: "90 sec" }
        ]},
        5: { name: "Lower Explosive", type: "lower", exercises: [
          { name: "Broad Jumps", sets: 5, reps: "5", rest: "2 min" },
          { name: "Speed Squats", sets: 5, reps: "3", rest: "2 min" },
          { name: "Romanian Deadlift", sets: 4, reps: "6", rest: "2.5 min" },
          { name: "Jump Squats", sets: 4, reps: "8", rest: "90 sec" },
          { name: "Sled Push", sets: 3, reps: "30 sec", rest: "2 min" }
        ]},
        6: { name: "Active Recovery", type: "rest", isRestDay: true }
      }
    },
    4: {
      name: "Strategic Deload", focus: "Active recovery, reduced volume, prepare for final push",
      rpe: "5-6/10", intensity: "60-65%",
      days: {
        1: { name: "Upper Push Light", type: "push", exercises: [
          { name: "Barbell Bench Press", sets: 3, reps: "8 @ 60%", rest: "2 min" },
          { name: "Dumbbell Overhead Press", sets: 3, reps: "10", rest: "90 sec" },
          { name: "Incline Dumbbell Press", sets: 2, reps: "12", rest: "90 sec" },
          { name: "Cable Flyes", sets: 2, reps: "15", rest: "60 sec" },
          { name: "Lateral Raises", sets: 2, reps: "15", rest: "60 sec" }
        ]},
        2: { name: "Lower Light", type: "lower", exercises: [
          { name: "Barbell Back Squat", sets: 3, reps: "8 @ 60%", rest: "2 min" },
          { name: "Romanian Deadlift", sets: 3, reps: "10", rest: "90 sec" },
          { name: "Goblet Squat", sets: 2, reps: "12", rest: "60 sec" },
          { name: "Walking Lunges", sets: 2, reps: "10/leg", rest: "60 sec" }
        ]},
        3: { name: "Upper Pull Light", type: "pull", exercises: [
          { name: "Barbell Row", sets: 3, reps: "8 @ 60%", rest: "2 min" },
          { name: "Dumbbell Rows", sets: 3, reps: "10/arm", rest: "90 sec" },
          { name: "Lat Pulldowns", sets: 2, reps: "12", rest: "90 sec" },
          { name: "Face Pulls", sets: 2, reps: "15", rest: "60 sec" },
          { name: "Bicep Curls", sets: 2, reps: "12", rest: "60 sec" }
        ]},
        4: { name: "Mobility & Movement", type: "full", exercises: [
          { name: "Dynamic Movement Flow", sets: 1, reps: "20 min", rest: "-" },
          { name: "Turkish Get-Ups", sets: 3, reps: "3/side", rest: "Light" },
          { name: "Farmer's Carries", sets: 3, reps: "30 sec", rest: "Light" },
          { name: "Core Circuit", sets: 2, reps: "Rounds", rest: "-" }
        ]},
        5: { name: "Optional Light", type: "rest", isRestDay: true },
        6: { name: "Active Recovery", type: "rest", isRestDay: true }
      }
    },
    5: {
      name: "Peak Performance", focus: "Return strong from deload, chase PRs",
      rpe: "8.5-9/10", intensity: "85-90%",
      days: {
        1: { name: "Upper Push Peak", type: "push", exercises: [
          { name: "Barbell Bench Press", sets: 6, reps: "4", rest: "3-4 min" },
          { name: "Overhead Press", sets: 4, reps: "5", rest: "3 min" },
          { name: "Weighted Dips", sets: 4, reps: "6", rest: "2 min" },
          { name: "Incline Bench Press", sets: 3, reps: "6", rest: "2 min" },
          { name: "Lateral Raise Superset", sets: 3, reps: "10+10", rest: "90 sec" }
        ]},
        2: { name: "Lower Peak", type: "lower", exercises: [
          { name: "Barbell Back Squat", sets: 6, reps: "4", rest: "3-4 min" },
          { name: "Barbell Deadlift", sets: 5, reps: "3", rest: "3-4 min" },
          { name: "Pause Front Squats", sets: 3, reps: "6", rest: "2.5 min" },
          { name: "Walking Barbell Lunges", sets: 3, reps: "8/leg", rest: "2 min" },
          { name: "Nordic Hamstring Curls", sets: 3, reps: "6", rest: "2 min" }
        ]},
        3: { name: "Upper Pull Peak", type: "pull", exercises: [
          { name: "Barbell Row", sets: 6, reps: "4", rest: "3-4 min" },
          { name: "Weighted Pull-Ups", sets: 5, reps: "5", rest: "3 min" },
          { name: "Chest-Supported Rows", sets: 4, reps: "8", rest: "2 min" },
          { name: "Barbell Shrugs", sets: 4, reps: "10", rest: "90 sec" },
          { name: "Weighted Chin-Ups", sets: 3, reps: "6", rest: "2 min" }
        ]},
        4: { name: "Olympic Movements", type: "full", exercises: [
          { name: "Power Cleans", sets: 6, reps: "2", rest: "2.5 min" },
          { name: "Clean and Press", sets: 4, reps: "4", rest: "2.5 min" },
          { name: "Front Squats", sets: 4, reps: "5", rest: "2.5 min" },
          { name: "Hang Cleans", sets: 3, reps: "5", rest: "2 min" }
        ]},
        5: { name: "Lower Strength-Speed", type: "lower", exercises: [
          { name: "Speed Squats", sets: 8, reps: "3 @ 70%", rest: "90 sec" },
          { name: "Deficit Deadlifts", sets: 4, reps: "5", rest: "3 min" },
          { name: "Heavy Box Jumps", sets: 4, reps: "4", rest: "2 min" },
          { name: "Bulgarian Split Squats", sets: 3, reps: "8/leg", rest: "90 sec" }
        ]},
        6: { name: "Recovery & Prep", type: "rest", isRestDay: true }
      }
    },
    6: {
      name: "Max Effort", focus: "Test new maxes, demonstrate gains, finish strong",
      rpe: "10/10", intensity: "90-100%",
      days: {
        1: { name: "Bench Press Max", type: "push", exercises: [
          { name: "Barbell Bench Press (MAX)", sets: 1, reps: "1RM", rest: "4-5 min" },
          { name: "Overhead Press", sets: 3, reps: "3 @ 85%", rest: "3 min" },
          { name: "Incline Press", sets: 3, reps: "6", rest: "2 min" },
          { name: "Accessory Pump Work", sets: 2, reps: "Light", rest: "-" }
        ]},
        2: { name: "Squat Max", type: "lower", exercises: [
          { name: "Barbell Back Squat (MAX)", sets: 1, reps: "1RM", rest: "4-5 min" },
          { name: "Front Squat", sets: 3, reps: "5 @ 75%", rest: "2.5 min" },
          { name: "Romanian Deadlift", sets: 3, reps: "8", rest: "2 min" },
          { name: "Walking Lunges", sets: 2, reps: "10/leg", rest: "Light" }
        ]},
        3: { name: "Active Recovery", type: "rest", isRestDay: true },
        4: { name: "Deadlift Max", type: "lower", exercises: [
          { name: "Barbell Deadlift (MAX)", sets: 1, reps: "1RM", rest: "4-5 min" },
          { name: "Deficit Deadlifts", sets: 3, reps: "3 @ 70%", rest: "3 min" },
          { name: "Glute Bridges", sets: 3, reps: "8", rest: "2 min" }
        ]},
        5: { name: "Upper Pull Test", type: "pull", exercises: [
          { name: "Weighted Pull-Ups (MAX)", sets: 1, reps: "Max", rest: "3-4 min" },
          { name: "Barbell Row", sets: 4, reps: "3 @ 85%", rest: "3 min" },
          { name: "Accessory Back Work", sets: 3, reps: "Light", rest: "-" },
          { name: "Arm Work", sets: 3, reps: "Pump", rest: "-" }
        ]},
        6: { name: "Victory Lap", type: "rest", isRestDay: true }
      }
    }
  }
};

// ============================================================
// ONBOARDING QUESTIONS
// ============================================================
const ONBOARDING_QUESTIONS = [
  {
    id: "name",
    question: "What should we call you?",
    type: "text",
    placeholder: "Your name or nickname",
    icon: "user"
  },
  {
    id: "level",
    question: "What's your fitness level?",
    type: "single",
    options: ["Beginner", "Intermediate", "Advanced"],
    allowCustom: true,
    customPlaceholder: "Describe your level..."
  },
  {
    id: "goals",
    question: "What are your goals?",
    subtitle: "Select all that apply",
    type: "multi",
    options: ["Strength", "Muscle Building", "Fat Loss", "General Fitness", "Athletic Performance", "Endurance"],
    allowCustom: true,
    customPlaceholder: "Add a custom goal..."
  },
  {
    id: "equipment",
    question: "What equipment do you have?",
    subtitle: "Select all that apply",
    type: "multi",
    options: ["Barbells & Squat Racks", "Dumbbells", "Kettlebells", "Medicine Balls", "Cable Machines", "Pull-Up Bar", "Resistance Bands", "Full Gym Access"],
    allowCustom: true,
    customPlaceholder: "Add other equipment..."
  },
  {
    id: "time",
    question: "How much time per session?",
    type: "single",
    options: ["30 minutes", "45 minutes", "60 minutes", "90 minutes"],
    allowCustom: true,
    customPlaceholder: "Specify time..."
  },
  {
    id: "days",
    question: "How many days per week?",
    type: "single",
    options: ["3 days", "4 days", "5 days", "6 days"],
    allowCustom: false
  },
  {
    id: "injuries",
    question: "Any injuries or limitations?",
    type: "multi",
    options: ["None", "Lower Back", "Shoulders", "Knees", "Wrists/Hands", "Neck"],
    allowCustom: true,
    customPlaceholder: "Describe other limitations..."
  }
];

// ============================================================
// UTILITY FUNCTIONS
// ============================================================
const parseRestToSeconds = (rest) => {
  if (!rest || rest === "-" || rest === "Circuit" || rest === "Light") return 60;
  const match = rest.match(/(\d+(?:\.\d+)?)/);
  if (!match) return 60;
  const num = parseFloat(match[1]);
  if (rest.includes("min")) return Math.round(num * 60);
  return num;
};

const formatTime = (seconds) => {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return `${m}:${s.toString().padStart(2, "0")}`;
};

const getTypeColor = (type, dark) => {
  const colors = {
    push: dark ? "#f472b6" : "#ec4899",
    pull: dark ? "#60a5fa" : "#3b82f6",
    lower: dark ? "#34d399" : "#10b981",
    full: dark ? "#fbbf24" : "#f59e0b",
    rest: dark ? "#a78bfa" : "#8b5cf6"
  };
  return colors[type] || (dark ? "#60a5fa" : "#3b82f6");
};

const getTypeBg = (type, dark) => {
  const colors = {
    push: dark ? "rgba(244,114,182,0.15)" : "rgba(236,72,153,0.1)",
    pull: dark ? "rgba(96,165,250,0.15)" : "rgba(59,130,246,0.1)",
    lower: dark ? "rgba(52,211,153,0.15)" : "rgba(16,185,129,0.1)",
    full: dark ? "rgba(251,191,36,0.15)" : "rgba(245,158,11,0.1)",
    rest: dark ? "rgba(167,139,250,0.15)" : "rgba(139,92,246,0.1)"
  };
  return colors[type] || (dark ? "rgba(96,165,250,0.15)" : "rgba(59,130,246,0.1)");
};

// ============================================================
// THEME
// ============================================================
const getTheme = (dark) => ({
  bg: dark ? "#0f0f14" : "#f8f7ff",
  card: dark ? "#1a1a24" : "#ffffff",
  cardAlt: dark ? "#222233" : "#f3f1ff",
  border: dark ? "#2a2a3d" : "#e8e5f5",
  text: dark ? "#e8e6f0" : "#1a1632",
  textSecondary: dark ? "#8b89a0" : "#6b6880",
  accent: dark ? "#8b7cf6" : "#6c5ce7",
  accentLight: dark ? "rgba(139,124,246,0.15)" : "rgba(108,92,231,0.08)",
  accentGlow: dark ? "rgba(139,124,246,0.3)" : "rgba(108,92,231,0.15)",
  success: dark ? "#34d399" : "#10b981",
  warning: dark ? "#fbbf24" : "#f59e0b",
  danger: dark ? "#f87171" : "#ef4444",
  inputBg: dark ? "#13131c" : "#faf9ff",
  shadow: dark ? "0 4px 24px rgba(0,0,0,0.4)" : "0 4px 24px rgba(108,92,231,0.08)",
  shadowLg: dark ? "0 8px 40px rgba(0,0,0,0.5)" : "0 8px 40px rgba(108,92,231,0.12)",
});

// ============================================================
// REST TIMER COMPONENT
// ============================================================
function RestTimer({ initialSeconds, dark, onClose }) {
  const t = getTheme(dark);
  const [seconds, setSeconds] = useState(initialSeconds || 60);
  const [isRunning, setIsRunning] = useState(false);
  const [total] = useState(initialSeconds || 60);
  const intervalRef = useRef(null);

  useEffect(() => {
    if (isRunning && seconds > 0) {
      intervalRef.current = setInterval(() => setSeconds(s => s - 1), 1000);
    } else {
      clearInterval(intervalRef.current);
    }
    if (seconds === 0 && isRunning) {
      setIsRunning(false);
    }
    return () => clearInterval(intervalRef.current);
  }, [isRunning, seconds]);

  const progress = total > 0 ? ((total - seconds) / total) * 100 : 0;
  const circumference = 2 * Math.PI * 54;
  const strokeDashoffset = circumference - (progress / 100) * circumference;

  return (
    <div style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,0.7)", backdropFilter: "blur(8px)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000 }}>
      <div style={{ background: t.card, borderRadius: 24, padding: 40, textAlign: "center", width: 320, boxShadow: t.shadowLg, border: `1px solid ${t.border}` }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 }}>
          <h3 style={{ color: t.text, margin: 0, fontSize: 18, fontWeight: 700 }}>Rest Timer</h3>
          <button onClick={onClose} style={{ background: "none", border: "none", color: t.textSecondary, cursor: "pointer", padding: 4 }}><Icon name="x" size={20}/></button>
        </div>
        <div style={{ position: "relative", width: 140, height: 140, margin: "0 auto 24px" }}>
          <svg width="140" height="140" viewBox="0 0 120 120" style={{ transform: "rotate(-90deg)" }}>
            <circle cx="60" cy="60" r="54" fill="none" stroke={t.border} strokeWidth="8" />
            <circle cx="60" cy="60" r="54" fill="none" stroke={seconds === 0 ? t.success : t.accent} strokeWidth="8" strokeLinecap="round" strokeDasharray={circumference} strokeDashoffset={strokeDashoffset} style={{ transition: "stroke-dashoffset 1s linear" }} />
          </svg>
          <div style={{ position: "absolute", inset: 0, display: "flex", alignItems: "center", justifyContent: "center" }}>
            <span style={{ fontSize: 36, fontWeight: 800, color: seconds === 0 ? t.success : t.text, fontVariantNumeric: "tabular-nums" }}>{formatTime(seconds)}</span>
          </div>
        </div>
        {seconds === 0 && <p style={{ color: t.success, fontWeight: 700, fontSize: 16, marginBottom: 16 }}>Time's up! Next set!</p>}
        <div style={{ display: "flex", gap: 12, justifyContent: "center" }}>
          <button onClick={() => setIsRunning(!isRunning)} style={{ background: isRunning ? t.warning : t.accent, color: "#fff", border: "none", borderRadius: 12, padding: "12px 24px", cursor: "pointer", fontWeight: 700, display: "flex", alignItems: "center", gap: 8 }}>
            {isRunning ? <><Icon name="pause" size={18}/> Pause</> : <><Icon name="play" size={18}/> {seconds === 0 ? "Done" : "Start"}</>}
          </button>
          <button onClick={() => { setSeconds(total); setIsRunning(false); }} style={{ background: t.cardAlt, color: t.text, border: `1px solid ${t.border}`, borderRadius: 12, padding: "12px 16px", cursor: "pointer", display: "flex", alignItems: "center", gap: 6 }}>
            <Icon name="rotateCcw" size={16}/> Reset
          </button>
        </div>
        <div style={{ display: "flex", gap: 8, justifyContent: "center", marginTop: 16 }}>
          {[30, 60, 90, 120, 180].map(s => (
            <button key={s} onClick={() => { setSeconds(s); setIsRunning(false); }}
              style={{ background: seconds === s && !isRunning ? t.accentLight : t.cardAlt, color: seconds === s ? t.accent : t.textSecondary, border: `1px solid ${seconds === s ? t.accent : t.border}`, borderRadius: 8, padding: "6px 10px", fontSize: 12, cursor: "pointer", fontWeight: 600 }}>
              {s < 60 ? `${s}s` : `${s / 60}m`}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MAIN APP COMPONENT
// ============================================================
function FitForge() {
  const [dark, setDark] = useState(false);
  const [screen, setScreen] = useState("loading");
  const [onboardingStep, setOnboardingStep] = useState(0);
  const [profile, setProfile] = useState({});
  const [activeTab, setActiveTab] = useState("home");
  const [selectedWeek, setSelectedWeek] = useState(1);
  const [selectedDay, setSelectedDay] = useState(1);
  const [workoutLogs, setWorkoutLogs] = useState({});
  const [bodyLogs, setBodyLogs] = useState([]);
  const [showTimer, setShowTimer] = useState(false);
  const [timerSeconds, setTimerSeconds] = useState(60);
  const [customInputs, setCustomInputs] = useState({});
  const [notification, setNotification] = useState(null);
  const [currentLog, setCurrentLog] = useState({});

  const t = getTheme(dark);
  const program = DEFAULT_PROGRAM;

  // Load saved data on mount
  useEffect(() => {
    try {
      const saved = localStorage.getItem("fitforge_profile");
      const savedLogs = localStorage.getItem("fitforge_logs");
      const savedBody = localStorage.getItem("fitforge_body");
      const savedDark = localStorage.getItem("fitforge_dark");
      if (savedDark) setDark(JSON.parse(savedDark));
      if (saved) {
        setProfile(JSON.parse(saved));
        setScreen("app");
      } else {
        setScreen("onboarding");
      }
      if (savedLogs) setWorkoutLogs(JSON.parse(savedLogs));
      if (savedBody) setBodyLogs(JSON.parse(savedBody));
    } catch {
      setScreen("onboarding");
    }
  }, []);

  // Save dark mode preference
  useEffect(() => {
    try { localStorage.setItem("fitforge_dark", JSON.stringify(dark)); } catch {}
  }, [dark]);

  const showNotif = (msg) => {
    setNotification(msg);
    setTimeout(() => setNotification(null), 2500);
  };

  const saveProfile = (p) => {
    setProfile(p);
    try { localStorage.setItem("fitforge_profile", JSON.stringify(p)); } catch {}
  };

  const saveLogs = (logs) => {
    setWorkoutLogs(logs);
    try { localStorage.setItem("fitforge_logs", JSON.stringify(logs)); } catch {}
  };

  const saveBodyLogs = (logs) => {
    setBodyLogs(logs);
    try { localStorage.setItem("fitforge_body", JSON.stringify(logs)); } catch {}
  };

  const loadWorkoutLog = useCallback((week, day) => {
    const key = `w${week}d${day}`;
    setCurrentLog(workoutLogs[key] || {});
  }, [workoutLogs]);

  useEffect(() => {
    if (screen === "app") loadWorkoutLog(selectedWeek, selectedDay);
  }, [selectedWeek, selectedDay, screen, loadWorkoutLog]);

  // ============================================================
  // ONBOARDING SCREEN
  // ============================================================
  const renderOnboarding = () => {
    const q = ONBOARDING_QUESTIONS[onboardingStep];
    const value = profile[q.id];
    const customVal = customInputs[q.id] || "";

    const handleSelect = (option) => {
      if (q.type === "single") {
        saveProfile({ ...profile, [q.id]: option });
      } else if (q.type === "multi") {
        const current = Array.isArray(value) ? value : [];
        if (option === "None") {
          saveProfile({ ...profile, [q.id]: ["None"] });
        } else {
          const filtered = current.filter(v => v !== "None");
          if (filtered.includes(option)) {
            saveProfile({ ...profile, [q.id]: filtered.filter(v => v !== option) });
          } else {
            saveProfile({ ...profile, [q.id]: [...filtered, option] });
          }
        }
      }
    };

    const addCustom = () => {
      if (!customVal.trim()) return;
      if (q.type === "single") {
        saveProfile({ ...profile, [q.id]: customVal.trim() });
      } else {
        const current = Array.isArray(value) ? value.filter(v => v !== "None") : [];
        saveProfile({ ...profile, [q.id]: [...current, customVal.trim()] });
      }
      setCustomInputs({ ...customInputs, [q.id]: "" });
    };

    const canProceed = q.type === "text" ? (value && value.trim()) : (q.type === "single" ? !!value : (Array.isArray(value) && value.length > 0));
    const isLast = onboardingStep === ONBOARDING_QUESTIONS.length - 1;

    return (
      <div style={{ minHeight: "100vh", background: t.bg, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", padding: 20 }}>
        <div style={{ width: "100%", maxWidth: 480 }}>
          {/* Progress */}
          <div style={{ display: "flex", gap: 6, marginBottom: 40 }}>
            {ONBOARDING_QUESTIONS.map((_, i) => (
              <div key={i} style={{ flex: 1, height: 4, borderRadius: 2, background: i <= onboardingStep ? t.accent : t.border, transition: "background 0.3s" }} />
            ))}
          </div>

          {/* Logo */}
          <div style={{ textAlign: "center", marginBottom: 32 }}>
            <div style={{ fontSize: 40, marginBottom: 8 }}>ðŸ”¥</div>
            <h1 style={{ fontSize: 28, fontWeight: 800, color: t.text, letterSpacing: "-0.5px", margin: 0 }}>FitForge</h1>
            <p style={{ color: t.textSecondary, fontSize: 13, marginTop: 4 }}>Step {onboardingStep + 1} of {ONBOARDING_QUESTIONS.length}</p>
          </div>

          {/* Question */}
          <div style={{ background: t.card, borderRadius: 20, padding: 32, boxShadow: t.shadowLg, border: `1px solid ${t.border}` }}>
            <h2 style={{ color: t.text, fontSize: 22, fontWeight: 700, marginBottom: 4, margin: 0 }}>{q.question}</h2>
            {q.subtitle && <p style={{ color: t.textSecondary, fontSize: 14, margin: "8px 0 0" }}>{q.subtitle}</p>}

            <div style={{ marginTop: 24 }}>
              {q.type === "text" ? (
                <input
                  type="text" value={value || ""} placeholder={q.placeholder}
                  onChange={e => saveProfile({ ...profile, [q.id]: e.target.value })}
                  onKeyDown={e => { if (e.key === "Enter" && canProceed) { isLast ? finishOnboarding() : setOnboardingStep(s => s + 1); }}}
                  style={{ width: "100%", padding: "16px 20px", borderRadius: 14, border: `2px solid ${t.border}`, background: t.inputBg, color: t.text, fontSize: 17, outline: "none", boxSizing: "border-box", fontWeight: 500 }}
                  autoFocus
                />
              ) : (
                <div style={{ display: "flex", flexWrap: "wrap", gap: 10 }}>
                  {q.options.map(opt => {
                    const selected = q.type === "single" ? value === opt : (Array.isArray(value) && value.includes(opt));
                    return (
                      <button key={opt} onClick={() => handleSelect(opt)}
                        style={{ padding: "12px 20px", borderRadius: 12, border: `2px solid ${selected ? t.accent : t.border}`, background: selected ? t.accentLight : t.cardAlt, color: selected ? t.accent : t.text, fontWeight: selected ? 700 : 500, cursor: "pointer", fontSize: 14, transition: "all 0.2s" }}>
                        {selected && <Icon name="check" size={14} style={{ marginRight: 6, verticalAlign: "middle" }}/>}
                        {opt}
                      </button>
                    );
                  })}
                </div>
              )}

              {q.allowCustom && q.type !== "text" && (
                <div style={{ display: "flex", gap: 10, marginTop: 16 }}>
                  <input
                    value={customVal} placeholder={q.customPlaceholder}
                    onChange={e => setCustomInputs({ ...customInputs, [q.id]: e.target.value })}
                    onKeyDown={e => { if (e.key === "Enter") addCustom(); }}
                    style={{ flex: 1, padding: "12px 16px", borderRadius: 12, border: `2px solid ${t.border}`, background: t.inputBg, color: t.text, fontSize: 14, outline: "none" }}
                  />
                  <button onClick={addCustom} style={{ background: t.accent, color: "#fff", border: "none", borderRadius: 12, padding: "12px 16px", cursor: "pointer", fontWeight: 700 }}>
                    <Icon name="plus" size={18}/>
                  </button>
                </div>
              )}
            </div>
          </div>

          {/* Navigation */}
          <div style={{ display: "flex", justifyContent: "space-between", marginTop: 24 }}>
            <button onClick={() => onboardingStep > 0 && setOnboardingStep(s => s - 1)}
              style={{ background: t.card, color: t.textSecondary, border: `1px solid ${t.border}`, borderRadius: 14, padding: "14px 24px", cursor: onboardingStep > 0 ? "pointer" : "default", opacity: onboardingStep > 0 ? 1 : 0.3, fontWeight: 600, display: "flex", alignItems: "center", gap: 6 }}>
              <Icon name="chevronLeft" size={18}/> Back
            </button>
            <button onClick={() => { if (!canProceed) return; isLast ? finishOnboarding() : setOnboardingStep(s => s + 1); }}
              style={{ background: canProceed ? t.accent : t.border, color: canProceed ? "#fff" : t.textSecondary, border: "none", borderRadius: 14, padding: "14px 32px", cursor: canProceed ? "pointer" : "default", fontWeight: 700, fontSize: 15, display: "flex", alignItems: "center", gap: 6, boxShadow: canProceed ? `0 4px 16px ${t.accentGlow}` : "none" }}>
              {isLast ? "Let's Go!" : "Next"} <Icon name="chevronRight" size={18}/>
            </button>
          </div>
        </div>
      </div>
    );
  };

  const finishOnboarding = () => {
    saveProfile(profile);
    setScreen("app");
  };

  // ============================================================
  // HOME TAB
  // ============================================================
  const renderHome = () => {
    const todayWorkouts = Object.keys(workoutLogs).length;
    const totalWorkouts = 36;
    const completionPct = Math.round((todayWorkouts / totalWorkouts) * 100);

    const getNextWorkout = () => {
      for (let w = 1; w <= 6; w++) {
        for (let d = 1; d <= 6; d++) {
          const key = `w${w}d${d}`;
          const dayData = program.weeks[w]?.days[d];
          if (dayData && !dayData.isRestDay && !workoutLogs[key]) {
            return { week: w, day: d, name: dayData.name };
          }
        }
      }
      return null;
    };
    const next = getNextWorkout();

    return (
      <div style={{ padding: "0 16px 120px" }}>
        {/* Welcome Card */}
        <div style={{ background: `linear-gradient(135deg, ${t.accent}, ${dark ? "#6c5ce7" : "#a78bfa"})`, borderRadius: 20, padding: 28, marginBottom: 20, color: "#fff", boxShadow: `0 8px 32px ${t.accentGlow}` }}>
          <p style={{ opacity: 0.85, fontSize: 14, marginBottom: 4 }}>Welcome back,</p>
          <h2 style={{ fontSize: 26, fontWeight: 800, margin: "0 0 16px", letterSpacing: "-0.5px" }}>{profile.name || "Athlete"}</h2>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-end" }}>
            <div>
              <p style={{ opacity: 0.85, fontSize: 13 }}>Program Progress</p>
              <p style={{ fontSize: 32, fontWeight: 800, margin: "4px 0 0" }}>{completionPct}%</p>
            </div>
            <div style={{ textAlign: "right" }}>
              <p style={{ opacity: 0.85, fontSize: 13 }}>{todayWorkouts} / {totalWorkouts}</p>
              <p style={{ fontSize: 13, opacity: 0.85 }}>workouts logged</p>
            </div>
          </div>
          {/* Progress bar */}
          <div style={{ background: "rgba(255,255,255,0.2)", borderRadius: 8, height: 8, marginTop: 16 }}>
            <div style={{ background: "#fff", borderRadius: 8, height: 8, width: `${completionPct}%`, transition: "width 0.5s" }} />
          </div>
        </div>

        {/* Next Workout */}
        {next && (
          <div onClick={() => { setSelectedWeek(next.week); setSelectedDay(next.day); setActiveTab("track"); }}
            style={{ background: t.card, borderRadius: 16, padding: 20, marginBottom: 20, boxShadow: t.shadow, border: `1px solid ${t.border}`, cursor: "pointer", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
            <div>
              <p style={{ color: t.textSecondary, fontSize: 12, fontWeight: 600, textTransform: "uppercase", letterSpacing: 1 }}>Up Next</p>
              <h3 style={{ color: t.text, fontSize: 18, fontWeight: 700, margin: "6px 0 4px" }}>Week {next.week} Â· Day {next.day}</h3>
              <p style={{ color: t.accent, fontSize: 14, fontWeight: 600 }}>{next.name}</p>
            </div>
            <div style={{ background: t.accentLight, borderRadius: 14, padding: 14 }}>
              <Icon name="chevronRight" size={24} color={t.accent}/>
            </div>
          </div>
        )}

        {/* Week Overview */}
        <h3 style={{ color: t.text, fontSize: 16, fontWeight: 700, marginBottom: 12 }}>Week Overview</h3>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 10, marginBottom: 24 }}>
          {[1, 2, 3, 4, 5, 6].map(w => {
            const weekData = program.weeks[w];
            const daysLogged = Object.keys(workoutLogs).filter(k => k.startsWith(`w${w}`)).length;
            const totalDays = Object.values(weekData.days).filter(d => !d.isRestDay).length;
            const pct = totalDays > 0 ? Math.round((daysLogged / totalDays) * 100) : 0;
            return (
              <button key={w} onClick={() => { setSelectedWeek(w); setActiveTab("program"); }}
                style={{ background: t.card, borderRadius: 14, padding: 16, border: `2px solid ${pct === 100 ? t.success : selectedWeek === w ? t.accent : t.border}`, cursor: "pointer", textAlign: "center", transition: "all 0.2s" }}>
                <p style={{ fontSize: 22, fontWeight: 800, color: pct === 100 ? t.success : t.text, margin: 0 }}>W{w}</p>
                <p style={{ fontSize: 11, color: t.textSecondary, margin: "4px 0 0", fontWeight: 600 }}>{weekData.name}</p>
                <div style={{ background: t.border, borderRadius: 4, height: 4, marginTop: 8 }}>
                  <div style={{ background: pct === 100 ? t.success : t.accent, borderRadius: 4, height: 4, width: `${pct}%` }} />
                </div>
              </button>
            );
          })}
        </div>

        {/* Quick Stats */}
        <h3 style={{ color: t.text, fontSize: 16, fontWeight: 700, marginBottom: 12 }}>Quick Stats</h3>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(2, 1fr)", gap: 10 }}>
          {[
            { icon: <Icon name="flame" size={20}/>, label: "Total Volume", value: `${Object.values(workoutLogs).reduce((sum, log) => { let v = 0; Object.keys(log).forEach(k => { if (k.startsWith("exercise")) { Object.keys(log[k]).forEach(sk => { if (sk.startsWith("set")) { const s = log[k][sk]; v += (parseFloat(s.weight) || 0) * (parseFloat(s.reps) || 0); } }); } }); return sum + v; }, 0).toLocaleString()} lbs`, color: t.danger },
            { icon: <Icon name="trophy" size={20}/>, label: "Workouts Done", value: todayWorkouts, color: t.warning },
            { icon: <Icon name="trendingUp" size={20}/>, label: "Current Week", value: `Week ${selectedWeek}`, color: t.accent },
            { icon: <Icon name="target" size={20}/>, label: "Streak", value: `${Math.min(todayWorkouts, 7)} days`, color: t.success }
          ].map((stat, i) => (
            <div key={i} style={{ background: t.card, borderRadius: 14, padding: 18, boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
              <div style={{ color: stat.color, marginBottom: 8 }}>{stat.icon}</div>
              <p style={{ fontSize: 22, fontWeight: 800, color: t.text, margin: "0 0 2px" }}>{stat.value}</p>
              <p style={{ fontSize: 12, color: t.textSecondary, fontWeight: 600, margin: 0 }}>{stat.label}</p>
            </div>
          ))}
        </div>
      </div>
    );
  };

  // ============================================================
  // PROGRAM TAB
  // ============================================================
  const renderProgram = () => {
    const week = program.weeks[selectedWeek];
    return (
      <div style={{ padding: "0 16px 120px" }}>
        {/* Week Selector */}
        <div style={{ display: "flex", gap: 8, overflowX: "auto", paddingBottom: 12, marginBottom: 20 }}>
          {[1, 2, 3, 4, 5, 6].map(w => (
            <button key={w} onClick={() => setSelectedWeek(w)}
              style={{ flexShrink: 0, padding: "10px 18px", borderRadius: 12, border: `2px solid ${selectedWeek === w ? t.accent : t.border}`, background: selectedWeek === w ? t.accentLight : t.card, color: selectedWeek === w ? t.accent : t.textSecondary, fontWeight: 700, cursor: "pointer", fontSize: 13 }}>
              W{w}
            </button>
          ))}
        </div>

        {/* Week Info */}
        <div style={{ background: t.card, borderRadius: 16, padding: 24, marginBottom: 20, boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
          <h2 style={{ color: t.text, fontSize: 22, fontWeight: 800, margin: "0 0 6px" }}>Week {selectedWeek}: {week.name}</h2>
          <p style={{ color: t.textSecondary, fontSize: 14, margin: 0 }}>{week.focus}</p>
          <div style={{ display: "flex", gap: 16, marginTop: 16 }}>
            <span style={{ background: t.accentLight, color: t.accent, padding: "6px 14px", borderRadius: 8, fontSize: 13, fontWeight: 700 }}>RPE {week.rpe}</span>
            <span style={{ background: t.accentLight, color: t.accent, padding: "6px 14px", borderRadius: 8, fontSize: 13, fontWeight: 700 }}>{week.intensity} 1RM</span>
          </div>
        </div>

        {/* Days */}
        {Object.entries(week.days).map(([dayNum, day]) => (
          <div key={dayNum} style={{ background: t.card, borderRadius: 16, marginBottom: 12, overflow: "hidden", boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
            <div style={{ background: getTypeBg(day.type, dark), padding: "16px 20px", display: "flex", justifyContent: "space-between", alignItems: "center", borderBottom: `1px solid ${t.border}` }}>
              <div>
                <span style={{ color: getTypeColor(day.type, dark), fontWeight: 800, fontSize: 13, textTransform: "uppercase", letterSpacing: 1 }}>Day {dayNum}</span>
                <h3 style={{ color: t.text, fontSize: 17, fontWeight: 700, margin: "4px 0 0" }}>{day.name}</h3>
              </div>
              {!day.isRestDay && (
                <button onClick={() => { setSelectedDay(parseInt(dayNum)); setActiveTab("track"); }}
                  style={{ background: getTypeColor(day.type, dark), color: "#fff", border: "none", borderRadius: 10, padding: "8px 16px", fontWeight: 700, cursor: "pointer", fontSize: 13 }}>
                  Track
                </button>
              )}
            </div>
            {!day.isRestDay && (
              <div style={{ padding: "12px 20px" }}>
                {day.exercises.map((ex, i) => (
                  <div key={i} style={{ padding: "10px 0", borderBottom: i < day.exercises.length - 1 ? `1px solid ${t.border}` : "none", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                    <span style={{ color: t.text, fontWeight: 600, fontSize: 14 }}>{ex.name}</span>
                    <span style={{ color: t.textSecondary, fontSize: 13 }}>{ex.sets} Ã— {ex.reps}</span>
                  </div>
                ))}
              </div>
            )}
            {day.isRestDay && (
              <div style={{ padding: 24, textAlign: "center" }}>
                <p style={{ color: t.textSecondary, fontSize: 14 }}>Light activity, stretching, foam rolling</p>
              </div>
            )}
          </div>
        ))}
      </div>
    );
  };

  // ============================================================
  // TRACKER TAB
  // ============================================================
  const renderTracker = () => {
    const week = program.weeks[selectedWeek];
    const day = week?.days[selectedDay];
    if (!day) return null;

    const updateLog = (field, value) => {
      setCurrentLog(prev => ({ ...prev, [field]: value }));
    };

    const updateExerciseSet = (exIdx, setNum, field, value) => {
      setCurrentLog(prev => {
        const exKey = `exercise${exIdx}`;
        const existing = prev[exKey] || {};
        const setKey = `set${setNum}`;
        return { ...prev, [exKey]: { ...existing, [setKey]: { ...(existing[setKey] || {}), [field]: value } } };
      });
    };

    const updateExerciseNotes = (exIdx, notes) => {
      setCurrentLog(prev => {
        const exKey = `exercise${exIdx}`;
        return { ...prev, [exKey]: { ...(prev[exKey] || {}), notes } };
      });
    };

    const saveCurrentWorkout = () => {
      const key = `w${selectedWeek}d${selectedDay}`;
      const newLogs = { ...workoutLogs, [key]: { ...currentLog, date: new Date().toISOString(), week: selectedWeek, day: selectedDay } };
      saveLogs(newLogs);
      showNotif("Workout saved!");
    };

    const clearCurrentWorkout = () => {
      const key = `w${selectedWeek}d${selectedDay}`;
      const newLogs = { ...workoutLogs };
      delete newLogs[key];
      saveLogs(newLogs);
      setCurrentLog({});
      showNotif("Workout cleared");
    };

    if (day.isRestDay) {
      return (
        <div style={{ padding: "0 16px 120px" }}>
          <div style={{ background: t.card, borderRadius: 20, padding: 40, textAlign: "center", boxShadow: t.shadowLg, border: `1px solid ${t.border}` }}>
            <div style={{ fontSize: 48, marginBottom: 16 }}>ðŸ§˜</div>
            <h2 style={{ color: t.text, fontSize: 24, fontWeight: 800, marginBottom: 8 }}>{day.name}</h2>
            <p style={{ color: t.textSecondary, fontSize: 15 }}>Recovery is where gains happen. Rest up!</p>
          </div>
        </div>
      );
    }

    return (
      <div style={{ padding: "0 16px 120px" }}>
        {/* Day Selector */}
        <div style={{ display: "flex", gap: 6, overflowX: "auto", paddingBottom: 8, marginBottom: 16 }}>
          {Object.entries(week.days).map(([dNum, d]) => (
            <button key={dNum} onClick={() => setSelectedDay(parseInt(dNum))}
              style={{ flexShrink: 0, padding: "8px 14px", borderRadius: 10, border: `2px solid ${selectedDay === parseInt(dNum) ? getTypeColor(d.type, dark) : t.border}`, background: selectedDay === parseInt(dNum) ? getTypeBg(d.type, dark) : t.card, color: selectedDay === parseInt(dNum) ? getTypeColor(d.type, dark) : t.textSecondary, fontWeight: 700, cursor: "pointer", fontSize: 12 }}>
              D{dNum}
            </button>
          ))}
        </div>

        {/* Header */}
        <div style={{ background: t.card, borderRadius: 16, padding: 20, marginBottom: 16, boxShadow: t.shadow, border: `1px solid ${t.border}`, display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: 12 }}>
          <div>
            <p style={{ color: t.textSecondary, fontSize: 12, fontWeight: 600, margin: 0 }}>Week {selectedWeek} Â· Day {selectedDay}</p>
            <h2 style={{ color: t.text, fontSize: 20, fontWeight: 800, margin: "4px 0 0" }}>{day.name}</h2>
          </div>
          <div style={{ display: "flex", gap: 8 }}>
            <button onClick={saveCurrentWorkout} style={{ background: t.accent, color: "#fff", border: "none", borderRadius: 10, padding: "10px 20px", fontWeight: 700, cursor: "pointer", fontSize: 13, boxShadow: `0 4px 12px ${t.accentGlow}` }}>Save</button>
            <button onClick={clearCurrentWorkout} style={{ background: t.cardAlt, color: t.danger, border: `1px solid ${t.border}`, borderRadius: 10, padding: "10px 14px", cursor: "pointer" }}><Icon name="trash" size={16}/></button>
          </div>
        </div>

        {/* Feeling */}
        <div style={{ background: t.card, borderRadius: 14, padding: 16, marginBottom: 16, boxShadow: t.shadow, border: `1px solid ${t.border}`, display: "flex", alignItems: "center", gap: 12 }}>
          <Icon name="heart" size={18} color={t.accent}/>
          <span style={{ color: t.textSecondary, fontSize: 13, fontWeight: 600 }}>Feeling</span>
          <div style={{ display: "flex", gap: 4, marginLeft: "auto" }}>
            {[1,2,3,4,5,6,7,8,9,10].map(n => (
              <button key={n} onClick={() => updateLog("feeling", n)}
                style={{ width: 28, height: 28, borderRadius: 8, border: `2px solid ${currentLog.feeling === n ? t.accent : t.border}`, background: currentLog.feeling === n ? t.accentLight : "transparent", color: currentLog.feeling === n ? t.accent : t.textSecondary, fontWeight: 700, fontSize: 11, cursor: "pointer" }}>
                {n}
              </button>
            ))}
          </div>
        </div>

        {/* Exercises */}
        {day.exercises.map((exercise, exIdx) => {
          const exLog = currentLog[`exercise${exIdx}`] || {};
          return (
            <div key={exIdx} style={{ background: t.card, borderRadius: 16, marginBottom: 12, overflow: "hidden", boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
              <div style={{ background: getTypeBg(day.type, dark), padding: "14px 18px", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                <div>
                  <h4 style={{ color: t.text, fontSize: 15, fontWeight: 700, margin: 0 }}>{exercise.name}</h4>
                  <p style={{ color: t.textSecondary, fontSize: 12, margin: "2px 0 0" }}>{exercise.sets} Ã— {exercise.reps} Â· Rest: {exercise.rest}</p>
                </div>
                <button onClick={() => { setTimerSeconds(parseRestToSeconds(exercise.rest)); setShowTimer(true); }}
                  style={{ background: getTypeColor(day.type, dark), color: "#fff", border: "none", borderRadius: 8, padding: "8px 12px", cursor: "pointer", display: "flex", alignItems: "center", gap: 4, fontWeight: 700, fontSize: 12 }}>
                  <Icon name="clock" size={14}/> Timer
                </button>
              </div>
              <div style={{ padding: "12px 18px" }}>
                {/* Column headers */}
                <div style={{ display: "grid", gridTemplateColumns: "44px 1fr 1fr 60px", gap: 8, marginBottom: 6, padding: "0 0 6px", borderBottom: `1px solid ${t.border}` }}>
                  <span style={{ fontSize: 10, color: t.textSecondary, fontWeight: 700, textTransform: "uppercase" }}>Set</span>
                  <span style={{ fontSize: 10, color: t.textSecondary, fontWeight: 700, textTransform: "uppercase" }}>Weight</span>
                  <span style={{ fontSize: 10, color: t.textSecondary, fontWeight: 700, textTransform: "uppercase" }}>Reps</span>
                  <span style={{ fontSize: 10, color: t.textSecondary, fontWeight: 700, textTransform: "uppercase", textAlign: "center" }}>Done</span>
                </div>
                {Array.from({ length: exercise.sets }, (_, setIdx) => {
                  const setNum = setIdx + 1;
                  const setLog = exLog[`set${setNum}`] || {};
                  return (
                    <div key={setIdx} style={{ display: "grid", gridTemplateColumns: "44px 1fr 1fr 60px", gap: 8, alignItems: "center", marginBottom: 6 }}>
                      <span style={{ color: t.accent, fontWeight: 800, fontSize: 14 }}>{setNum}</span>
                      <input type="number" step="2.5" placeholder="lbs" value={setLog.weight || ""}
                        onChange={e => updateExerciseSet(exIdx, setNum, "weight", e.target.value)}
                        style={{ padding: "10px 12px", borderRadius: 10, border: `2px solid ${t.border}`, background: t.inputBg, color: t.text, fontSize: 14, outline: "none", textAlign: "center", fontWeight: 600 }} />
                      <input type="number" placeholder="reps" value={setLog.reps || ""}
                        onChange={e => updateExerciseSet(exIdx, setNum, "reps", e.target.value)}
                        style={{ padding: "10px 12px", borderRadius: 10, border: `2px solid ${t.border}`, background: t.inputBg, color: t.text, fontSize: 14, outline: "none", textAlign: "center", fontWeight: 600 }} />
                      <div style={{ textAlign: "center" }}>
                        <button onClick={() => updateExerciseSet(exIdx, setNum, "completed", !setLog.completed)}
                          style={{ width: 32, height: 32, borderRadius: 8, border: `2px solid ${setLog.completed ? t.success : t.border}`, background: setLog.completed ? t.success : "transparent", cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", margin: "0 auto" }}>
                          {setLog.completed && <Icon name="check" size={16} color="#fff"/>}
                        </button>
                      </div>
                    </div>
                  );
                })}
                {/* Exercise notes */}
                <textarea placeholder="Notes (form, RPE, how it felt...)" value={exLog.notes || ""}
                  onChange={e => updateExerciseNotes(exIdx, e.target.value)}
                  style={{ width: "100%", padding: "10px 14px", borderRadius: 10, border: `2px solid ${t.border}`, background: t.inputBg, color: t.text, fontSize: 13, outline: "none", resize: "vertical", minHeight: 40, marginTop: 8, fontFamily: "inherit", boxSizing: "border-box" }} />
              </div>
            </div>
          );
        })}
      </div>
    );
  };

  // ============================================================
  // PROGRESS TAB
  // ============================================================
  const renderProgress = () => {
    // Build chart data from logs
    const mainLifts = ["Barbell Bench Press", "Barbell Back Squat", "Barbell Deadlift", "Overhead Press", "Barbell Bent-Over Row"];

    const getChartData = () => {
      const data = [];
      for (let w = 1; w <= 6; w++) {
        const point = { week: `W${w}` };
        mainLifts.forEach(liftName => {
          let bestWeight = 0;
          for (let d = 1; d <= 6; d++) {
            const key = `w${w}d${d}`;
            const log = workoutLogs[key];
            if (!log) continue;
            const weekData = program.weeks[w]?.days[d];
            if (!weekData || weekData.isRestDay) continue;
            weekData.exercises.forEach((ex, exIdx) => {
              if (ex.name.includes(liftName.replace("Barbell ", "")) || ex.name === liftName) {
                const exLog = log[`exercise${exIdx}`];
                if (exLog) {
                  Object.keys(exLog).forEach(sk => {
                    if (sk.startsWith("set")) {
                      const w2 = parseFloat(exLog[sk]?.weight) || 0;
                      if (w2 > bestWeight) bestWeight = w2;
                    }
                  });
                }
              }
            });
          });
          point[liftName] = bestWeight || null;
        });
        data.push(point);
      }
      return data;
    };

    const chartData = getChartData();
    const hasData = chartData.some(d => mainLifts.some(l => d[l]));

    // Volume per week
    const volumeData = [];
    for (let w = 1; w <= 6; w++) {
      let vol = 0;
      for (let d = 1; d <= 6; d++) {
        const key = `w${w}d${d}`;
        const log = workoutLogs[key];
        if (log) {
          Object.keys(log).forEach(k => {
            if (k.startsWith("exercise")) {
              Object.keys(log[k]).forEach(sk => {
                if (sk.startsWith("set")) {
                  const s = log[k][sk];
                  vol += (parseFloat(s.weight) || 0) * (parseFloat(s.reps) || 0);
                }
              });
            }
          });
        }
      }
      volumeData.push({ week: `W${w}`, volume: vol });
    }

    const chartColors = [t.accent, t.success, t.danger, t.warning, "#60a5fa"];

    return (
      <div style={{ padding: "0 16px 120px" }}>
        <h2 style={{ color: t.text, fontSize: 22, fontWeight: 800, marginBottom: 20 }}>Progress</h2>

        {/* Strength Progress */}
        <div style={{ background: t.card, borderRadius: 16, padding: 20, marginBottom: 20, boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
          <h3 style={{ color: t.text, fontSize: 16, fontWeight: 700, marginBottom: 16 }}>Strength Progress (lbs)</h3>
          {hasData ? (
            <ResponsiveContainer width="100%" height={260}>
              <LineChart data={chartData}>
                <CartesianGrid strokeDasharray="3 3" stroke={t.border} />
                <XAxis dataKey="week" stroke={t.textSecondary} fontSize={12} />
                <YAxis stroke={t.textSecondary} fontSize={12} />
                <ChartTooltip contentStyle={{ background: t.card, border: `1px solid ${t.border}`, borderRadius: 8, color: t.text }} />
                <Legend wrapperStyle={{ fontSize: 11 }} />
                {mainLifts.map((lift, i) => (
                  <Line key={lift} type="monotone" dataKey={lift} stroke={chartColors[i]} strokeWidth={2} dot={{ r: 4 }} connectNulls name={lift.replace("Barbell ", "")} />
                ))}
              </LineChart>
            </ResponsiveContainer>
          ) : (
            <div style={{ textAlign: "center", padding: 32, color: t.textSecondary }}>
              <Icon name="barChart" size={40} style={{ marginBottom: 12, opacity: 0.3 }}/>
              <p>Log workouts to see your strength progress here.</p>
            </div>
          )}
        </div>

        {/* Volume Chart */}
        <div style={{ background: t.card, borderRadius: 16, padding: 20, marginBottom: 20, boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
          <h3 style={{ color: t.text, fontSize: 16, fontWeight: 700, marginBottom: 16 }}>Weekly Volume (lbs)</h3>
          <ResponsiveContainer width="100%" height={200}>
            <BarChart data={volumeData}>
              <CartesianGrid strokeDasharray="3 3" stroke={t.border} />
              <XAxis dataKey="week" stroke={t.textSecondary} fontSize={12} />
              <YAxis stroke={t.textSecondary} fontSize={12} />
              <ChartTooltip contentStyle={{ background: t.card, border: `1px solid ${t.border}`, borderRadius: 8, color: t.text }} />
              <Bar dataKey="volume" fill={t.accent} radius={[6, 6, 0, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>

        {/* Body Measurements */}
        <div style={{ background: t.card, borderRadius: 16, padding: 20, boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
            <h3 style={{ color: t.text, fontSize: 16, fontWeight: 700, margin: 0 }}>Body Measurements</h3>
            <button onClick={() => {
              const entry = { date: new Date().toISOString().split("T")[0], weight: "", chest: "", waist: "", hips: "", arms: "" };
              saveBodyLogs([...bodyLogs, entry]);
            }} style={{ background: t.accent, color: "#fff", border: "none", borderRadius: 8, padding: "8px 14px", cursor: "pointer", fontWeight: 700, fontSize: 12, display: "flex", alignItems: "center", gap: 4 }}>
              <Icon name="plus" size={14}/> Add Entry
            </button>
          </div>

          {bodyLogs.length === 0 ? (
            <div style={{ textAlign: "center", padding: 24, color: t.textSecondary }}>
              <Icon name="weight" size={32} style={{ marginBottom: 8, opacity: 0.3 }}/>
              <p style={{ fontSize: 13 }}>Track your body measurements over time.</p>
            </div>
          ) : (
            <>
              {bodyLogs.length > 1 && (
                <ResponsiveContainer width="100%" height={180}>
                  <LineChart data={bodyLogs.filter(b => b.weight).map(b => ({ date: b.date, weight: parseFloat(b.weight) }))}>
                    <CartesianGrid strokeDasharray="3 3" stroke={t.border} />
                    <XAxis dataKey="date" stroke={t.textSecondary} fontSize={10} />
                    <YAxis stroke={t.textSecondary} fontSize={12} domain={["auto", "auto"]} />
                    <ChartTooltip contentStyle={{ background: t.card, border: `1px solid ${t.border}`, borderRadius: 8, color: t.text }} />
                    <Line type="monotone" dataKey="weight" stroke={t.accent} strokeWidth={2} dot={{ r: 4 }} />
                  </LineChart>
                </ResponsiveContainer>
              )}
              <div style={{ marginTop: 12 }}>
                {bodyLogs.map((entry, idx) => (
                  <div key={idx} style={{ display: "grid", gridTemplateColumns: "80px repeat(5, 1fr) 32px", gap: 6, alignItems: "center", marginBottom: 8, fontSize: 12 }}>
                    <span style={{ color: t.textSecondary, fontWeight: 600 }}>{entry.date}</span>
                    {["weight", "chest", "waist", "hips", "arms"].map(field => (
                      <input key={field} type="number" step="0.1" placeholder={field} value={entry[field] || ""}
                        onChange={e => {
                          const updated = [...bodyLogs];
                          updated[idx] = { ...updated[idx], [field]: e.target.value };
                          saveBodyLogs(updated);
                        }}
                        style={{ padding: "8px 4px", borderRadius: 8, border: `1px solid ${t.border}`, background: t.inputBg, color: t.text, fontSize: 12, textAlign: "center", outline: "none", width: "100%" }} />
                    ))}
                    <button onClick={() => { const updated = bodyLogs.filter((_, i) => i !== idx); saveBodyLogs(updated); }}
                      style={{ background: "none", border: "none", color: t.danger, cursor: "pointer", padding: 4 }}><Icon name="x" size={14}/></button>
                  </div>
                ))}
                <div style={{ display: "grid", gridTemplateColumns: "80px repeat(5, 1fr) 32px", gap: 6, fontSize: 10, color: t.textSecondary, fontWeight: 600, paddingTop: 4, borderTop: `1px solid ${t.border}` }}>
                  <span>Date</span><span>Weight</span><span>Chest</span><span>Waist</span><span>Hips</span><span>Arms</span><span></span>
                </div>
              </div>
            </>
          )}
        </div>
      </div>
    );
  };

  // ============================================================
  // PROFILE TAB
  // ============================================================
  const renderProfile = () => {
    return (
      <div style={{ padding: "0 16px 120px" }}>
        <h2 style={{ color: t.text, fontSize: 22, fontWeight: 800, marginBottom: 20 }}>Profile</h2>

        <div style={{ background: t.card, borderRadius: 16, padding: 24, marginBottom: 20, boxShadow: t.shadow, border: `1px solid ${t.border}` }}>
          <div style={{ display: "flex", alignItems: "center", gap: 16, marginBottom: 24 }}>
            <div style={{ width: 60, height: 60, borderRadius: 16, background: `linear-gradient(135deg, ${t.accent}, ${dark ? "#6c5ce7" : "#a78bfa"})`, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 28, fontWeight: 800, color: "#fff" }}>
              {(profile.name || "A")[0].toUpperCase()}
            </div>
            <div>
              <h3 style={{ color: t.text, fontSize: 20, fontWeight: 800, margin: 0 }}>{profile.name || "Athlete"}</h3>
              <p style={{ color: t.textSecondary, fontSize: 13, margin: "2px 0 0" }}>{profile.level || "Intermediate"}</p>
            </div>
          </div>

          {[
            { label: "Goals", value: Array.isArray(profile.goals) ? profile.goals.join(", ") : profile.goals },
            { label: "Equipment", value: Array.isArray(profile.equipment) ? profile.equipment.join(", ") : profile.equipment },
            { label: "Session Time", value: profile.time },
            { label: "Days/Week", value: profile.days },
            { label: "Limitations", value: Array.isArray(profile.injuries) ? profile.injuries.join(", ") : profile.injuries }
          ].map((item, i) => (
            <div key={i} style={{ padding: "14px 0", borderBottom: i < 4 ? `1px solid ${t.border}` : "none" }}>
              <p style={{ color: t.textSecondary, fontSize: 12, fontWeight: 600, margin: "0 0 4px", textTransform: "uppercase", letterSpacing: 0.5 }}>{item.label}</p>
              <p style={{ color: t.text, fontSize: 15, fontWeight: 500, margin: 0 }}>{item.value || "Not set"}</p>
            </div>
          ))}
        </div>

        {/* Dark Mode Toggle */}
        <div style={{ background: t.card, borderRadius: 16, padding: 20, marginBottom: 20, boxShadow: t.shadow, border: `1px solid ${t.border}`, display: "flex", justifyContent: "space-between", alignItems: "center" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
            {dark ? <Icon name="moon" size={20} color={t.accent}/> : <Icon name="sun" size={20} color={t.warning}/>}
            <span style={{ color: t.text, fontWeight: 600 }}>Dark Mode</span>
          </div>
          <button onClick={() => setDark(!dark)}
            style={{ width: 52, height: 28, borderRadius: 14, background: dark ? t.accent : t.border, border: "none", cursor: "pointer", position: "relative", transition: "background 0.3s" }}>
            <div style={{ width: 22, height: 22, borderRadius: 11, background: "#fff", position: "absolute", top: 3, left: dark ? 27 : 3, transition: "left 0.3s", boxShadow: "0 2px 4px rgba(0,0,0,0.2)" }} />
          </button>
        </div>

        {/* Actions */}
        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          <button onClick={() => {
            const data = JSON.stringify({ profile, workoutLogs, bodyLogs }, null, 2);
            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a"); a.href = url; a.download = "fitforge-data.json"; a.click();
          }} style={{ background: t.card, color: t.accent, border: `1px solid ${t.border}`, borderRadius: 14, padding: 16, cursor: "pointer", fontWeight: 700, fontSize: 14 }}>
            Export All Data
          </button>
          <button onClick={() => {
            if (confirm("Reset everything? This cannot be undone.")) {
              localStorage.clear();
              setProfile({});
              setWorkoutLogs({});
              setBodyLogs({});
              setScreen("onboarding");
              setOnboardingStep(0);
            }
          }} style={{ background: t.card, color: t.danger, border: `1px solid ${t.border}`, borderRadius: 14, padding: 16, cursor: "pointer", fontWeight: 700, fontSize: 14 }}>
            Reset App & Data
          </button>
        </div>
      </div>
    );
  };

  // ============================================================
  // LOADING SCREEN
  // ============================================================
  if (screen === "loading") {
    return (
      <div style={{ minHeight: "100vh", background: t.bg, display: "flex", alignItems: "center", justifyContent: "center" }}>
        <div style={{ textAlign: "center" }}>
          <div style={{ fontSize: 56, marginBottom: 16 }}>ðŸ”¥</div>
          <h1 style={{ color: t.text, fontSize: 32, fontWeight: 800, letterSpacing: "-1px" }}>FitForge</h1>
        </div>
      </div>
    );
  }

  // ============================================================
  // ONBOARDING
  // ============================================================
  if (screen === "onboarding") return renderOnboarding();

  // ============================================================
  // MAIN APP
  // ============================================================
  const tabs = [
    { id: "home", label: "Home", icon: <Icon name="home" size={20}/> },
    { id: "program", label: "Program", icon: <Icon name="book" size={20}/> },
    { id: "track", label: "Track", icon: <Icon name="dumbbell" size={20}/> },
    { id: "progress", label: "Progress", icon: <Icon name="barChart" size={20}/> },
    { id: "profile", label: "Profile", icon: <Icon name="user" size={20}/> },
  ];

  return (
    <div style={{ minHeight: "100vh", background: t.bg, paddingBottom: 80 }}>
      {/* Top Bar */}
      <div style={{ position: "sticky", top: 0, zIndex: 100, background: t.bg, borderBottom: `1px solid ${t.border}`, padding: "16px 20px", display: "flex", justifyContent: "space-between", alignItems: "center", backdropFilter: "blur(12px)" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <span style={{ fontSize: 24 }}>ðŸ”¥</span>
          <h1 style={{ color: t.text, fontSize: 20, fontWeight: 800, margin: 0, letterSpacing: "-0.5px" }}>FitForge</h1>
        </div>
        <button onClick={() => setDark(!dark)} style={{ background: t.cardAlt, border: `1px solid ${t.border}`, borderRadius: 10, padding: 10, cursor: "pointer", display: "flex", alignItems: "center" }}>
          {dark ? <Icon name="sun" size={18} color={t.warning}/> : <Icon name="moon" size={18} color={t.accent}/>}
        </button>
      </div>

      {/* Content */}
      <div style={{ paddingTop: 16 }}>
        {activeTab === "home" && renderHome()}
        {activeTab === "program" && renderProgram()}
        {activeTab === "track" && renderTracker()}
        {activeTab === "progress" && renderProgress()}
        {activeTab === "profile" && renderProfile()}
      </div>

      {/* Bottom Nav */}
      <div style={{ position: "fixed", bottom: 0, left: 0, right: 0, background: t.card, borderTop: `1px solid ${t.border}`, display: "flex", justifyContent: "space-around", padding: "8px 0 env(safe-area-inset-bottom, 8px)", zIndex: 100, boxShadow: `0 -2px 20px ${dark ? "rgba(0,0,0,0.4)" : "rgba(0,0,0,0.05)"}` }}>
        {tabs.map(tab => (
          <button key={tab.id} onClick={() => setActiveTab(tab.id)}
            style={{ background: "none", border: "none", cursor: "pointer", display: "flex", flexDirection: "column", alignItems: "center", gap: 4, padding: "8px 16px", color: activeTab === tab.id ? t.accent : t.textSecondary, transition: "color 0.2s" }}>
            {tab.icon}
            <span style={{ fontSize: 10, fontWeight: activeTab === tab.id ? 700 : 500 }}>{tab.label}</span>
          </button>
        ))}
      </div>

      {/* Rest Timer Modal */}
      {showTimer && <RestTimer initialSeconds={timerSeconds} dark={dark} onClose={() => setShowTimer(false)} />}

      {/* Notification Toast */}
      {notification && (
        <div style={{ position: "fixed", top: 20, left: "50%", transform: "translateX(-50%)", background: t.success, color: "#fff", padding: "12px 24px", borderRadius: 12, fontWeight: 700, zIndex: 1100, boxShadow: "0 4px 20px rgba(0,0,0,0.3)", animation: "slideDown 0.3s ease" }}>
          <Icon name="check" size={16} style={{ verticalAlign: "middle", marginRight: 8 }}/>{notification}
        </div>
      )}

      <style>{`
        @keyframes slideDown { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        ::-webkit-scrollbar { height: 4px; width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: ${t.border}; border-radius: 4px; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif; }
      `}</style>
    </div>
  );
}


    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(FitForge));
    </script>
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js').catch(function() {});
        });
    }
    </script>
</body>
</html>